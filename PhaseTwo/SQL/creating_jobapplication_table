-- taken from Jered's work in GitHub
CREATE TABLE IF NOT EXISTS USER(
  User_ID INT NOT NULL AUTO_INCREMENT,
  First_Name VARCHAR(50) NOT NULL,
  Last_Name VARCHAR(50) NOT NULL,
  Middle_Initial CHAR(1) DEFAULT NULL,
  Email VARCHAR(100) NOT NULL,
  Phone VARCHAR(15) DEFAULT NULL,
  City VARCHAR(50) DEFAULT NULL,
  County VARCHAR(50) NOT NULL,
  Zip_Code CHAR(5) DEFAULT NULL,
  PRIMARY KEY (User_ID),
  UNIQUE KEY (Email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

ALTER TABLE USER
ADD COLUMN employer_id INT;

ALTER TABLE USER
ADD CONSTRAINT fk_user_employer
	FOREIGN KEY (employer_id)
    REFERENCES employer(employer_id);

ALTER TABLE USER
ADD COLUMN recruiter_id INT;

ALTER TABLE USER
ADD UNIQUE (recruiter_id);
-- this was generated by Sonnet 4.5
CREATE TABLE IF NOT EXISTS Job_Application(
    job_id INT,
    user_id INT,
    applied_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    referred_by INT NULL,
    status ENUM('External', 'Received', 'Under_Review', 'Interview_Scheduled', 'Rejected', 'Accepted') 
        DEFAULT 'Received',
    
    -- Composite primary key (one application per user per job)
    PRIMARY KEY (job_id, user_id),
    
    -- Foreign key to Jobs table
    CONSTRAINT fk_application_job
    FOREIGN KEY (job_id) REFERENCES Jobs(job_id)
    ON DELETE CASCADE  -- If job deleted, remove applications
    ON UPDATE CASCADE,
    
    -- Foreign key to User table
    CONSTRAINT fk_application_user
    FOREIGN KEY (user_id) REFERENCES User(user_id)
    ON DELETE CASCADE  -- If user deleted, remove their applications
    ON UPDATE CASCADE,
    
    -- Foreign key for referral (self-referencing User table)
    CONSTRAINT fk_application_referrer
    FOREIGN KEY (referred_by) REFERENCES User(user_id)
    ON DELETE SET NULL  -- If referrer deleted, keep application but clear referral
    ON UPDATE CASCADE
);

ALTER TABLE Jobs
ADD CONSTRAINT fk_jobs_employer
    FOREIGN KEY (employer_id) REFERENCES Employer(employer_id);

ALTER TABLE Jobs
ADD CONSTRAINT fk_jobs_recruiter
    FOREIGN KEY (recruiter_id) REFERENCES USER(recruiter_id);

